<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_delivery_document_inherit_blockchain" inherit_id="stock.report_delivery_document">
        
        <xpath expr="//div[@name='div_sched_date']" position="after">
            
            <div t-if="o.move_line_ids.lot_id" style="margin-top: 15px; page-break-inside: avoid;">
                
                <div style="margin-bottom: 10px;">
                    <strong style="font-size: 13px;">BLOCKCHAIN TRACEABILITY (TRUY XUẤT NGUỒN GỐC):</strong>
                </div>
                
                <div style="width: 100%;">
                    
                    <t t-foreach="o.move_line_ids.mapped('lot_id')" t-as="lot">
                        
                        <div style="display: inline-block; 
                                    vertical-align: top; 
                                    width: 120px; 
                                    text-align: center; 
                                    border: 1px solid #dee2e6; 
                                    padding: 8px; 
                                    margin-right: 10px; 
                                    margin-bottom: 10px;
                                    border-radius: 4px; 
                                    background-color: #f8f9fa;">
                            
                            <div style="font-size: 11px; font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                Lô: <t t-esc="lot.name"/>
                            </div>
                            
                            <img t-att-src="'/report/barcode/?barcode_type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('QR', o.get_blockchain_url_for_lot(lot), 200, 200)" 
                                 style="width: 85px; height: 85px; margin-top: 5px;" 
                                 alt="QR Code"/>
                            
                            <div t-if="lot.genesis_hash" style="margin-top: 4px;">
                                <span style="font-size: 8px; color: #666; font-family: monospace;">
                                    <t t-esc="lot.genesis_hash[:10]"/>...
                                </span>
                            </div>

                        </div>
                    </t>
                </div>
            </div>
        </xpath>

    </template>
</odoo>